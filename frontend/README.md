# React + TypeScript 認証フロントエンドアプリケーション

このアプリケーションは、React、TypeScript、Viteを使用して構築されたモダンなフロントエンドアプリケーションです。UIフレームワークとして[Material-UI](https://mui.com/)を、認証バックエンドとしてAWS Cognitoを利用しています。

## コンセプト：家を建てるように理解するアーキテクチャ

このアプリケーションの構造は、一軒の「家」を建てるプロセスに例えることができます。各ファイルやディレクトリが、家の土台、柱、部屋、設備といった特定の役割を担っています。この例えを通して、複雑なフロントエンドのアーキテクチャを直感的に理解しましょう。

---

## アーキテクチャ解説

### 1. `src/main.tsx` - エントリーポイント（家の土台と玄関）

すべての始まりの場所です。Reactアプリケーション全体をブラウザのDOMツリーに接続（レンダリング）する役割を持ちます。

-   **役割**: Reactアプリケーションの起動。
-   **詳細**: `ReactDOM.createRoot` を使用して、`public/index.html` 内の `<div id="root"></div>` という要素をReactが管理するルートとして設定します。そして、そのルートにメインコンポーネントである `<App />` を描画します。
-   **例え**: 家を建てるための「基礎工事」です。この土台の上に、`<App />`という名の家が建てられます。

### 2. `src/App.tsx` - アプリケーションの司令塔（家の間取りと設計責任者）

アプリケーション全体の構造と、どの画面をいつ表示するかのロジックを管理する中心的なコンポーネントです。

-   **役割**: 全体のレイアウト定義、テーマの提供、認証状態に基づいた画面の切り替え。
-   **詳細**:
    -   `<ThemeProvider>`: Material-UIからインポートされ、アプリケーション全体に一貫したデザインテーマ（色、フォントなど）を提供します。AWSのオレンジをプライマリカラーとして設定しています。
    -   `<AuthProvider>`: 後述する`AuthContext`をアプリケーション全体で利用可能にするためのプロバイダーです。これにより、どのコンポーネントからでも認証状態にアクセスできます。
    -   `<MainApp />`: 認証状態（`loading`, `isAuthenticated`）を`useAuth()`フックから取得し、以下のロジックで表示するコンポーネントを決定します。
        -   **ローディング中**: `CircularProgress`を表示。
        -   **認証済み**: `<DashboardApp />`（メイン画面）を表示。
        -   **未認証**: ユーザーの操作に応じて`<LoginForm />`, `<SignUpForm />`, `<ConfirmSignUpForm />`のいずれかを表示。
-   **例え**: 家の「設計責任者」兼「執事」。家のデザインルール（ThemeProvider）を決め、警備システム（AuthProvider）を導入し、訪問者（ユーザー）の状態に応じて適切な部屋（コンポーネント）へ案内します。

### 3. `src/components/` - 再利用可能なUI部品（家具や建具）

アプリケーションを構成する個々のUIパーツです。それぞれが特定の機能と見た目を持ち、組み合わせて画面を構築します。

-   **役割**: UIの部品化。
-   **詳細**:
    -   `auth/`: `LoginForm.tsx`, `SignUpForm.tsx`, `ConfirmSignUpForm.tsx`など、認証に関連するフォームコンポーネントが格納されています。
    -   `DashboardApp.tsx`: 認証後のユーザーが利用するメインアプリケーション画面です。
-   **例え**: 家の中の「ドア」「窓」「家具」など。これらを組み合わせることで、リビングルームや寝室といった具体的な部屋（画面）が作られます。

### 4. `src/contexts/AuthContext.tsx` - グローバルな状態管理（家の警備システム）

ReactのContext APIを利用して、認証に関する状態とロジックをアプリケーション全体で共有するための仕組みです。

-   **役割**: 認証状態（ユーザー情報、ログイン状態など）の一元管理と、各コンポーネントへの提供。
-   **詳細**:
    -   `createContext`: 認証情報を格納するためのグローバルなデータストアを作成します。
    -   `AuthProvider`: このコンポーネントで囲われたすべての子コンポーネントが、Contextのデータにアクセスできるようになります。認証状態のチェックや、`authService`を介したログイン・ログアウト処理もここで行います。
    -   `useAuth`: 各コンポーネントがContextのデータ（`user`, `isAuthenticated`）や関数（`signIn`, `signOut`）に簡単にアクセスするためのカスタムフックです。
-   **例え**: 家全体に張り巡らされた「高度な警備システム」。どの部屋のインターホン（`useAuth`）からでも、警備センター（`AuthContext`）に問い合わせたり、操作したりできます。

### 5. `src/services/authService.ts` - 外部APIとの通信層（警備会社との通信機）

バックエンドの認証サービス（AWS Cognito）との実際の通信処理をすべて担当するクラスです。

-   **役割**: UIロジックと外部API通信の分離。
-   **詳細**:
    -   `amazon-cognito-identity-js`ライブラリを直接利用し、Cognito User Poolへのサインアップ、サインイン、トークン取得などの具体的な処理を実装しています。
    -   UIコンポーネントは、`AuthService`のメソッドを呼び出すだけでよく、Cognitoの複雑な仕様を意識する必要がありません。これにより、コードの見通しが良くなり、テストやメンテナンスが容易になります。
-   **例え**: 警備システムが外部の警備会社本部（Cognito）とやり取りするための「専用の通信機」。UI（家の住人）は通信機の使い方（`AuthService`のメソッド）さえ知っていれば、複雑な通信プロトコル（CognitoのAPI）を理解する必要はありません。

---

## 処理の流れ：ユーザー体験のシーケンス

1.  **起動**: `main.tsx`が`<App />`をレンダリングします。
2.  **認証状態の確認**: `<AuthProvider>`がマウントされ、`useEffect`内で`AuthService.isAuthenticated()`を呼び出し、Cognitoに現在のセッションが有効か問い合わせます（ローディング画面表示）。
3.  **画面分岐**:
    -   **セッション有効時**: `isAuthenticated`が`true`になり、`<DashboardApp />`が表示されます。
    -   **セッション無効時**: `isAuthenticated`が`false`になり、デフォルトで`<LoginForm />`が表示されます。
4.  **ログイン/新規登録**:
    -   ユーザーがフォームに入力し、ボタンをクリックします。
    -   イベントハンドラが`useAuth()`フックから`signIn()`や`signUp()`を呼び出します。
    -   `AuthContext`内で`AuthService`の対応するメソッドが呼び出され、Cognitoと通信します。
    -   処理が成功すると、`AuthContext`内のユーザー状態が更新され、Reactが自動的に画面を再レンダリングして`<DashboardApp />`に切り替えます。

---

## 開発の始め方

1.  **依存関係のインストール**:
    ```bash
    npm install
    ```

2.  **環境変数の設定**:
    プロジェクトルートに`.env.local`ファイルを作成し、使用するAWS Cognito User Poolの情報を記述します。
    ```
    VITE_USER_POOL_ID=us-east-1_xxxxxxxxx
    VITE_USER_POOL_CLIENT_ID=xxxxxxxxxxxxxxxxxxxxxxxxxx
    ```

3.  **開発サーバーの起動**:
    ```bash
    npm run dev
    ```
    サーバーが起動し、ブラウザでアプリケーションにアクセスできるようになります。